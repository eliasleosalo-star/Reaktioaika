<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reaktioaikatesti ‚Äì Testaa reaktioaikasi verkossa</title>
  <meta name="description" content="Yksinkertainen ja hauska reaktioaikatesti: odota vihre√§√§ ja klikkaa niin nopeasti kuin pystyt. Testaa ja jaa tuloksesi!" />
  <meta name="keywords" content="reaktioaikatesti, reaktioaika, reaction time test, peli, testi, nopeus" />
  <meta name="author" content="Elias Leosalo" />
  <meta name="google-site-verification" content="i7sBGgDOuck7BBuLbRntRqmrJY8sXkDfXSTVHi5Qzlo" />
  <style>
    :root {
      --bg-idle: #0f172a;
      --bg-wait: #ef4444;
      --bg-go:   #22c55e;
      --bg-early:#f59e0b;
      --text:    #e5e7eb;
      --muted:   #94a3b8;
      --card:    rgba(15, 23, 42, 0.6);
      --btn:     #1f2937;
      --btnh:    #374151;
      --accent:  #38bdf8;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      display: grid;
      place-items: center;
      background: var(--bg-idle);
      transition: background-color 140ms ease-in-out, background 140ms ease-in-out;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      outline: none;
    }
    body.wait    { background: var(--bg-wait); }
    body.go      { background: var(--bg-go); }
    body.early   { background: var(--bg-early); }

    #app { width: min(960px, 95vw); display: flex; flex-direction: column; align-items: center; gap: 18px; padding: 24px; }
    .title { font-size: clamp(28px, 5vw, 44px); font-weight: 800; }
    .message { font-size: clamp(22px, 4vw, 34px); font-weight: 700; }
    .subtext { font-size: clamp(14px, 2.4vw, 18px); color: var(--muted); }
    .row { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center; }
    .panel { background: var(--card); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(6px); padding: 16px 18px; border-radius: 16px; }
    .stat { font-size: clamp(22px, 4vw, 30px); font-weight: 800; }
    .small { font-size: 12px; letter-spacing: 0.4px; text-transform: uppercase; color: var(--muted); }
    footer { opacity: 0.9; font-size: 12px; color: var(--muted); text-align: center; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .kbd { font-family: ui-monospace; font-weight: 700; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.18); }
    #overlay { position: fixed; inset: 0; }
    .spacer { height: clamp(160px, 34vh, 420px); width: 100%; pointer-events: none; }
    /* FAQ */
    details.faq { text-align: left; background: var(--card); border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; padding: 12px 14px; }
    details.faq + details.faq { margin-top: 10px; }
    details.faq[open] { border-color: rgba(255,255,255,0.2); }
    details.faq summary { list-style: none; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 800; }
    details.faq summary::-webkit-details-marker { display: none; }
    .faq-content { color: var(--muted); margin-top: 8px; line-height: 1.5; }
  </style>
</head>
<body tabindex="0" aria-live="polite">
  <div id="overlay" aria-hidden="true"></div>
  <main id="app" role="main">
    <div class="title">Reaktioaikatesti</div>
    <div id="message" class="message">Klikkaa tai paina <span class="kbd">v√§lily√∂nti</span> aloittaaksesi</div>
    <div id="sub" class="subtext">Kun tausta vaihtuu <strong>vihre√§ksi</strong>, klikkaa niin nopeasti kuin pystyt.</div>
    <div class="spacer" aria-hidden="true"></div>
    <section id="results" class="panel">
      <div class="row" style="justify-content: space-between; gap: 16px;">
        <div><div class="small">Viimeisin</div><div id="last" class="stat">‚Äì</div></div>
        <div><div class="small">Paras</div><div id="best" class="stat">‚Äì</div></div>
        <div><div class="small">Keskiarvo (5)</div><div id="avg" class="stat">‚Äì</div></div>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="toggle-sound" type="button" aria-pressed="true">üîä √Ñ√§ni p√§√§ll√§</button>
        <button id="share" type="button">üì§ Jaa tulos</button>
        <button id="reset" type="button" class="btn-ghost">‚ôªÔ∏è Nollaa tilastot</button>
      </div>
      <div class="subtext" style="margin-top:8px">Vinkki: voit k√§ytt√§√§ my√∂s <span class="kbd">Enter</span>- tai <span class="kbd">v√§lily√∂nti</span>-n√§pp√§int√§.</div>
      <div class="small" style="margin-top:12px">Viimeiset tulokset</div>
      <div id="history" class="subtext">‚Äî</div>
    </section>
    <section class="panel"><div class="small" style="margin-bottom:8px">Lis√§tietoa</div>
      <details class="faq"><summary>‚ùì Mik√§ on hyv√§ reaktioaika?</summary><div class="faq-content">Keskim√§√§r√§inen reaktioaika aikuisilla on noin 250 ms. Nuorilla ja pelaajilla usein 150‚Äì200 ms.</div></details>
      <details class="faq"><summary>‚ö° Miten parannan reaktioaikaa?</summary><div class="faq-content">Harjoittelu, uni ja keskittyminen vaikuttavat. My√∂s silm√§‚Äìk√§si‚Äëkoordinaatiota kehitt√§v√§t lajit auttavat.</div></details>
      <details class="faq"><summary>üñ•Ô∏è Vaikuttaako selain tai laite?</summary><div class="faq-content">Kyll√§, esim. n√§yt√∂n virkistystaajuus ja laitteen kuormitus voivat tuoda pieni√§ eroja.</div></details>
    </section>
    <footer>Rakennettu ilman kirjastoja. ¬© <span id="year"></span> ‚Ä¢ <a href="#" id="permalink">Pysyv√§ linkki</a></footer>
  </main>
  <script>
    (function() {
      const $ = (id) => document.getElementById(id);
      const body = document.body;
      const msg = $("message");
      const sub = $("sub");
      const lastEl = $("last");
      const bestEl = $("best");
      const avgEl  = $("avg");
      const histEl = $("history");
      const btnSound = $("toggle-sound");
      const btnShare = $("share");
      const btnReset = $("reset");
      const overlay = $("overlay");
      const YEAR = $("year"); YEAR.textContent = new Date().getFullYear();
      const link = $("permalink"); link.addEventListener('click', e => { e.preventDefault(); navigator.clipboard.writeText(location.href).then(() => toast('Linkki kopioitu')); });

      // --- Pelilogiikan tilat
      const TRIALS = 5;                 // yritysten m√§√§r√§ per sarja
      let state = 'idle';               // 'idle' | 'wait' | 'go' | 'early' | 'result'
      let seriesComplete = false;       // tosi kun 5/5 suoritettu
      let timer = null;
      let startTs = 0;

      // Tulokset: t√§m√§n sarjan tulokset (1..5), pysyv√§sti tallennetaan vain paras
      let blockResults = [];
      let best = Number(localStorage.getItem('rt_best') || '0');
      let beepOn = JSON.parse(localStorage.getItem('rt_beep') || 'true');

      // --- √Ñ√§ni (WebAudio) kun GO
      let ctx = null;
      function beep() {
        if (!beepOn) return;
        try {
          ctx = ctx || new (window.AudioContext || window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = 'sine';
          o.frequency.setValueAtTime(880, ctx.currentTime);
          g.gain.setValueAtTime(0.001, ctx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.16);
          o.connect(g).connect(ctx.destination);
          o.start();
          o.stop(ctx.currentTime + 0.18);
        } catch {}
      }

      // --- Apurit
      function fmt(ms) { return Math.round(ms) + ' ms'; }
      function average(arr){ if(!arr.length) return 0; return arr.reduce((a,b)=>a+b,0)/arr.length; }
      function saveStats() { localStorage.setItem('rt_best', String(best)); }

      function updateStatsDisplay(lastVal = null) {
        lastEl.textContent = lastVal ? fmt(lastVal) : (blockResults.length ? fmt(blockResults[blockResults.length-1]) : '‚Äì');
        bestEl.textContent = best ? fmt(best) : '‚Äì';
        const avg = average(blockResults);
        avgEl.textContent = avg ? fmt(avg) : '‚Äì';
        histEl.textContent = blockResults.length ? blockResults.map(v=>fmt(v)).join(' ¬∑ ') : '‚Äî';
      }

      function setState(next) {
        state = next;
        body.classList.remove('wait','go','early');
        switch(next) {
          case 'idle':
            msg.innerHTML = 'Klikkaa tai paina <span class="kbd">v√§lily√∂nti</span> aloittaaksesi';
            sub.innerHTML = `Kun tausta vaihtuu <strong>vihre√§ksi</strong>, klikkaa niin nopeasti kuin pystyt. Sarjassa ${TRIALS} yrityst√§.`;
            break;
          case 'wait':
            body.classList.add('wait');
            msg.textContent = 'Odota vihre√§√§‚Ä¶';
            sub.textContent = '√Ñl√§ klikkaa viel√§!';
            break;
          case 'go':
            body.classList.add('go');
            msg.textContent = 'Nyt! Klikkaa!';
            sub.textContent = 'Mittaa reaktioaikasi';
            break;
          case 'early':
            body.classList.add('early');
            msg.textContent = 'Liian aikaisin!';
            sub.textContent = 'Klikkaa yritt√§√§ksesi uudelleen';
            break;
          case 'result':
            // viesti asetetaan finishRoundissa jos sarja valmis
            if (!seriesComplete) {
              msg.textContent = 'Hyv√§! Klikkaa yritt√§√§ksesi uudelleen';
              sub.textContent = 'Kokeile parantaa tulostasi';
            }
            break;
        }
      }

      function startRound() {
        if (timer) clearTimeout(timer);
        setState('wait');
        // Lis√§√§ pari sekuntia viivett√§ ja tee vaikeammaksi arvata
        const delay = Math.floor(2500 + Math.random()*3500); // 2500‚Äì6000 ms
        timer = setTimeout(() => {
          startTs = performance.now();
          setState('go');
          beep();
        }, delay);
      }

      function tooSoon() {
        if (timer) clearTimeout(timer);
        setState('early');
      }

      function finishRound() {
        const rt = performance.now() - startTs;
        blockResults.push(rt);
        if (!best || rt < best) best = rt;
        saveStats();
        updateStatsDisplay(rt);
        if (blockResults.length >= TRIALS) {
          seriesComplete = true;
          msg.textContent = `Sarja valmis! Keskiarvo: ${fmt(average(blockResults))}`;
          sub.textContent = 'Klikkaa aloittaaksesi uuden 5 yrityksen sarjan';
        }
        setState('result');
      }

      function handlePress() {
        // Jos sarja valmis, seuraava klikkaus nollaa ja k√§ynnist√§√§ uuden sarjan
        if (seriesComplete && (state==='result' || state==='idle' || state==='early')) {
          blockResults = [];
          seriesComplete = false;
          updateStatsDisplay();
          startRound();
          return;
        }
        switch(state) {
          case 'idle':
          case 'result':
          case 'early':
            startRound();
            break;
          case 'wait':
            tooSoon();
            break;
          case 'go':
            finishRound();
            break;
        }
      }

      // --- Sy√∂te
      overlay.addEventListener('pointerdown', (e) => { e.preventDefault(); handlePress(); }, { passive: false });
      document.addEventListener('keydown', (e) => {
        if (e.repeat) return;
        if (e.code === 'Space' || e.code === 'Enter' || e.code === 'NumpadEnter') {
          e.preventDefault();
          handlePress();
        }
      });

      // --- Napit
      function renderSoundBtn() {
        btnSound.textContent = (beepOn ? 'üîä √Ñ√§ni p√§√§ll√§' : 'üîá √Ñ√§ni pois');
        btnSound.setAttribute('aria-pressed', String(beepOn));
      }
      btnSound.addEventListener('click', () => { beepOn = !beepOn; localStorage.setItem('rt_beep', JSON.stringify(beepOn)); renderSoundBtn(); });

      btnShare.addEventListener('click', async () => {
        const last = blockResults.at(-1);
        const text = last ? `Reaktioaikani: ${fmt(last)} ‚Äî testaa oma t√§√§ll√§!` : 'Testaa reaktioaikasi!';
        try {
          if (navigator.share) {
            await navigator.share({ title: 'Reaktioaikatesti', text, url: location.href });
          } else {
            await navigator.clipboard.writeText(`${text} ${location.href}`);
            toast('Kopioitu leikep√∂yd√§lle');
          }
        } catch {}
      });

      btnReset.addEventListener('click', () => {
        blockResults = [];
        best = 0;
        seriesComplete = false;
        saveStats();
        updateStatsDisplay();
        toast('Tilastot nollattu');
      });

      // Tiny toast
      let toastEl = null; let toastTimer = null;
      function toast(text) {
        if (!toastEl) {
          toastEl = document.createElement('div');
          toastEl.style.cssText = 'position:fixed;left:50%;bottom:26px;transform:translateX(-50%);background:rgba(15,23,42,.9);color:#e5e7eb;padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.15);font-weight:700;z-index:9999;';
          document.body.appendChild(toastEl);
        }
        toastEl.textContent = text;
        toastEl.style.opacity = '1';
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => { toastEl.style.opacity = '0'; }, 1200);
      }

      // Init
      renderSoundBtn();
      updateStatsDisplay();
      setState('idle');
      // Focus for keyboard use
      setTimeout(() => { try { document.body.focus(); } catch {} }, 0);
    })();
  </script>
</body>
</html>
